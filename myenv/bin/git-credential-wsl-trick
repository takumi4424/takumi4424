#!/bin/bash
set -eu

# WSL2から.exeを呼び出すとすごい遅い。
# しかし、/mnt/c/以下から呼び出すと普通に早い。
# なので、/mnt/c/以下に移動した後にGCMを呼び出すように小細工を行う。
#
# このスクリプトの名前がgit-credential-wsl-trickなので、
# $ git config credential.helper wsl-trick
# するとこのスクリプトが呼び出される。
#
# 参考情報:
# - https://git-scm.com/book/ja/v2/Git-のさまざまなツール-認証情報の保存
# - https://learn.microsoft.com/ja-jp/windows/wsl/tutorials/wsl-git

cd /mnt/c/Program\ Files/Git/mingw64
if [[ -f ./bin/git-credential-manager.exe ]]; then
    # Git for Windows >= v2.39.0
    ./bin/git-credential-manager.exe "$@"
elif [[ -f ./bin/git-credential-manager-core.exe ]]; then
    # Git for Windows >= v2.36.1
    ./bin/git-credential-manager-core.exe "$@"
else
    # Git for Windows < v2.36.1
    ./libexec/git-core/git-credential-manager.exe "$@"
fi
